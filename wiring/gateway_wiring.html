<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Theater LoRa Gateway Wiring ‚Äî ESP32-S3 Feather</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background: #1a1a2e; color: #e0e0e0; margin: 0; padding: 20px; }
  h1 { color: #e94560; text-align: center; font-size: 1.4em; margin-bottom: 4px; }
  .subtitle { text-align: center; color: #a0a0b0; font-size: 0.85em; margin-bottom: 24px; }

  .diagram { display: flex; justify-content: center; align-items: flex-start; gap: 40px; flex-wrap: wrap; }

  .board {
    background: #16213e;
    border: 2px solid #0f3460;
    border-radius: 10px;
    padding: 14px 10px;
    min-width: 160px;
    position: relative;
  }
  .board h2 { text-align: center; font-size: 0.8em; margin: 0 0 10px 0; color: #e94560; text-transform: uppercase; letter-spacing: 1px; }
  .board .pid { text-align: center; font-size: 0.68em; color: #606080; margin-bottom: 8px; }

  .pin { display: flex; justify-content: space-between; align-items: center; margin: 3px 0; font-size: 0.75em; }
  .pin-label { padding: 2px 6px; border-radius: 3px; font-weight: bold; }
  .pin-value { color: #a0c4ff; font-size: 0.9em; }

  .pwr  { background: #c0392b; color: #fff; }
  .gnd  { background: #2c2c2c; color: #aaa; }
  .sck  { background: #8e44ad; color: #fff; }
  .mosi { background: #1a6b3a; color: #fff; }
  .miso { background: #16537e; color: #fff; }
  .cs   { background: #b7770d; color: #fff; }
  .rst  { background: #5d4037; color: #fff; }
  .irq  { background: #1a5276; color: #fff; }
  .data { background: #1a5276; color: #fff; }
  .usb  { background: #7d3c98; color: #fff; }

  .connections {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 5px;
    min-width: 240px;
  }
  .conn-row {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.72em;
  }
  .conn-from { text-align: right; min-width: 100px; font-weight: bold; }
  .conn-arrow { color: #e94560; flex-shrink: 0; }
  .conn-to { min-width: 100px; font-weight: bold; }
  .conn-wire { color: #606080; font-size: 0.85em; margin-left: 4px; }
  .conn-note { color: #606080; font-size: 0.9em; }

  .section-title {
    text-align: center;
    font-size: 0.72em;
    color: #e94560;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin: 4px 0 6px 0;
    border-bottom: 1px solid #0f3460;
    padding-bottom: 4px;
  }

  .note-box {
    background: #0f3460;
    border-left: 3px solid #e94560;
    border-radius: 4px;
    padding: 10px 14px;
    margin: 20px auto;
    max-width: 900px;
    font-size: 0.78em;
    line-height: 1.7;
  }
  .note-box b { color: #e94560; }

  .power-note {
    background: #1a0a0a;
    border-left: 3px solid #c0392b;
    border-radius: 4px;
    padding: 10px 14px;
    margin: 10px auto;
    max-width: 900px;
    font-size: 0.78em;
    line-height: 1.7;
  }
  .power-note b { color: #e74c3c; }

  .warn-box {
    background: #2d1a00;
    border-left: 3px solid #f39c12;
    border-radius: 4px;
    padding: 10px 14px;
    margin: 10px auto;
    max-width: 900px;
    font-size: 0.78em;
    line-height: 1.7;
  }
  .warn-box b { color: #f39c12; }

  .config-box {
    background: #0a1a1a;
    border-left: 3px solid #1abc9c;
    border-radius: 4px;
    padding: 10px 14px;
    margin: 10px auto;
    max-width: 900px;
    font-size: 0.78em;
    line-height: 1.7;
  }
  .config-box b { color: #1abc9c; }
  .config-box code { background: #16213e; padding: 1px 5px; border-radius: 3px; font-family: monospace; }

  .parts-list {
    background: #16213e;
    border-radius: 4px;
    padding: 12px 16px;
    margin: 16px auto;
    max-width: 900px;
    font-size: 0.78em;
  }
  .parts-list h3 { color: #e94560; margin: 0 0 8px 0; font-size: 1em; }
  .parts-list table { width: 100%; border-collapse: collapse; }
  .parts-list td { padding: 4px 8px; }
  .parts-list td:first-child { color: #a0c4ff; }
  .parts-list td:last-child { color: #606080; text-align: right; }

  .pin-ref {
    background: #16213e;
    border-radius: 4px;
    padding: 12px 16px;
    margin: 16px auto;
    max-width: 900px;
    font-size: 0.78em;
  }
  .pin-ref h3 { color: #e94560; margin: 0 0 8px 0; font-size: 1em; }
  .pin-ref table { width: 100%; border-collapse: collapse; }
  .pin-ref th { color: #e94560; text-align: left; padding: 6px 8px; border-bottom: 1px solid #0f3460; }
  .pin-ref td { padding: 4px 8px; }
  .pin-ref td:first-child { color: #a0c4ff; font-family: monospace; }
  .pin-ref td:nth-child(2) { color: #1abc9c; font-weight: bold; }
  .pin-ref td:nth-child(3) { color: #e0e0e0; }
  .pin-ref td:last-child { color: #606080; font-size: 0.9em; }

  .spi-diagram {
    background: #16213e;
    border-radius: 4px;
    padding: 12px 16px;
    margin: 16px auto;
    max-width: 900px;
    font-size: 0.78em;
    text-align: center;
  }
  .spi-diagram h3 { color: #e94560; margin: 0 0 12px 0; font-size: 1em; }
  .spi-bus {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
    margin-top: 8px;
  }
  .spi-device {
    background: #0f3460;
    border-radius: 6px;
    padding: 8px 12px;
    min-width: 100px;
  }
  .spi-device .name { color: #e94560; font-weight: bold; margin-bottom: 4px; }
  .spi-device .pins { font-size: 0.85em; color: #a0c4ff; }
  .spi-label { color: #606080; font-size: 0.9em; }
</style>
</head>
<body>

<h1>Theater LoRa ‚Äî Gateway Wiring</h1>
<div class="subtitle">Adafruit ESP32-S3 Feather (#5477) + WIZ5500 Ethernet (#6348) + RFM95W LoRa (#3072)</div>

<div class="parts-list">
<h3>Parts</h3>
<table>
  <tr><td>Adafruit ESP32-S3 Feather 4MB Flash / 2MB PSRAM</td><td>#5477</td></tr>
  <tr><td>Adafruit WIZ5500 Ethernet Breakout</td><td>#6348</td></tr>
  <tr><td>Adafruit RFM95W LoRa Radio Breakout - 915MHz</td><td>#3072</td></tr>
  <tr><td>915MHz Spring Antenna (uFL)</td><td>#4269</td></tr>
  <tr><td>Ethernet cable (to switch or Eos console)</td><td>‚Äî</td></tr>
  <tr><td>USB-C cable for power/programming</td><td>‚Äî</td></tr>
  <tr><td>Jumper wires (female-to-female recommended)</td><td>‚Äî</td></tr>
</table>
</div>

<div class="pin-ref">
<h3>ESP32-S3 Feather Pin Reference</h3>
<table>
  <tr><th>CircuitPython</th><th>GPIO</th><th>Function</th><th>Notes</th></tr>
  <tr><td><code>board.SCK</code></td><td>GPIO 36</td><td>SPI Clock</td><td>Ethernet SPI bus</td></tr>
  <tr><td><code>board.MOSI</code></td><td>GPIO 35</td><td>SPI MOSI</td><td>Ethernet SPI TX</td></tr>
  <tr><td><code>board.MISO</code></td><td>GPIO 37</td><td>SPI MISO</td><td>Ethernet SPI RX</td></tr>
  <tr><td><code>board.D9</code></td><td>GPIO 9</td><td>Ethernet CS</td><td>WIZ5500 chip select</td></tr>
  <tr><td><code>board.D10</code></td><td>GPIO 10</td><td>LoRa SCK</td><td>Secondary SPI clock</td></tr>
  <tr><td><code>board.D11</code></td><td>GPIO 11</td><td>LoRa MOSI</td><td>Secondary SPI TX</td></tr>
  <tr><td><code>board.D12</code></td><td>GPIO 12</td><td>LoRa MISO</td><td>Secondary SPI RX</td></tr>
  <tr><td><code>board.D13</code></td><td>GPIO 13</td><td>LoRa CS</td><td>RFM95W chip select</td></tr>
  <tr><td><code>board.A0</code></td><td>GPIO 17</td><td>LoRa RST</td><td>Reset</td></tr>
  <tr><td><code>board.A1</code></td><td>GPIO 18</td><td>LoRa IRQ</td><td>G0/DIO0 interrupt</td></tr>
</table>
</div>

<div class="diagram">

  <!-- FEATHER BOARD -->
  <div class="board" style="min-width:180px">
    <h2>ESP32-S3 Feather</h2>
    <div class="pid">#5477</div>

    <div class="section-title">Power</div>
    <div class="pin"><span class="pin-label pwr">3.3V</span><span class="pin-value">‚Üí both breakouts</span></div>
    <div class="pin"><span class="pin-label gnd">GND</span><span class="pin-value">‚Üí both breakouts</span></div>
    <div class="pin"><span class="pin-label usb">USB-C</span><span class="pin-value">power + programming</span></div>

    <div class="section-title">SPI Bus 1 ‚Äî Ethernet</div>
    <div class="pin"><span class="pin-label sck">SCK</span><span class="pin-value">‚Üí WIZ SCK</span></div>
    <div class="pin"><span class="pin-label mosi">MOSI</span><span class="pin-value">‚Üí WIZ MOSI</span></div>
    <div class="pin"><span class="pin-label miso">MISO</span><span class="pin-value">‚Üí WIZ MISO</span></div>
    <div class="pin"><span class="pin-label cs">D9</span><span class="pin-value">‚Üí WIZ CS</span></div>

    <div class="section-title">SPI Bus 2 ‚Äî LoRa</div>
    <div class="pin"><span class="pin-label sck">D10</span><span class="pin-value">‚Üí RFM SCK</span></div>
    <div class="pin"><span class="pin-label mosi">D11</span><span class="pin-value">‚Üí RFM MOSI</span></div>
    <div class="pin"><span class="pin-label miso">D12</span><span class="pin-value">‚Üí RFM MISO</span></div>
    <div class="pin"><span class="pin-label cs">D13</span><span class="pin-value">‚Üí RFM CS</span></div>
    <div class="pin"><span class="pin-label rst">A0</span><span class="pin-value">‚Üí RFM RST</span></div>
    <div class="pin"><span class="pin-label irq">A1</span><span class="pin-value">‚Üí RFM G0/IRQ</span></div>
  </div>

  <!-- CONNECTION TABLES -->
  <div style="display:flex; flex-direction:column; gap:20px;">

    <div class="connections">
      <div class="section-title">WIZ5500 Ethernet Breakout (#6348)</div>
      <div class="conn-row">
        <span class="conn-from" style="color:#c0392b">Feather 3.3V</span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#c0392b">VIN</span>
        <span class="conn-wire">red</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#888">Feather GND</span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#888">GND</span>
        <span class="conn-wire">black</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#8e44ad">SCK <span style="color:#1abc9c">(GPIO36)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#8e44ad">SCK</span>
        <span class="conn-wire">orange</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#1a6b3a">MOSI <span style="color:#1abc9c">(GPIO35)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#1a6b3a">MOSI</span>
        <span class="conn-wire">green</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#16537e">MISO <span style="color:#1abc9c">(GPIO37)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#16537e">MISO</span>
        <span class="conn-wire">blue</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#b7770d">D9 <span style="color:#1abc9c">(GPIO9)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#b7770d">CS</span>
        <span class="conn-wire">yellow</span>
      </div>
      <div class="conn-row" style="margin-top:6px">
        <span style="color:#e94560; font-weight:bold">NETWORK:</span>
        <span style="color:#606080">Ethernet cable ‚Üí switch / Eos console</span>
      </div>
    </div>

    <div class="connections">
      <div class="section-title">RFM95W LoRa Breakout (#3072)</div>
      <div class="conn-row">
        <span class="conn-from" style="color:#c0392b">Feather 3.3V</span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#c0392b">VIN</span>
        <span class="conn-wire">red</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#888">Feather GND</span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#888">GND</span>
        <span class="conn-wire">black</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#8e44ad">D10 <span style="color:#1abc9c">(GPIO10)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#8e44ad">SCK</span>
        <span class="conn-wire">orange</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#1a6b3a">D11 <span style="color:#1abc9c">(GPIO11)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#1a6b3a">MOSI</span>
        <span class="conn-wire">green</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#16537e">D12 <span style="color:#1abc9c">(GPIO12)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#16537e">MISO</span>
        <span class="conn-wire">blue</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#b7770d">D13 <span style="color:#1abc9c">(GPIO13)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#b7770d">CS</span>
        <span class="conn-wire">yellow</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#795548">A0 <span style="color:#1abc9c">(GPIO17)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#795548">RST</span>
        <span class="conn-wire">brown</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#1a5276">A1 <span style="color:#1abc9c">(GPIO18)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#1a5276">G0 (IRQ)</span>
        <span class="conn-wire">white</span>
      </div>
      <div class="conn-row" style="margin-top:6px">
        <span style="color:#e94560; font-weight:bold">ANTENNA:</span>
        <span style="color:#606080">Spring antenna (#4269) ‚Üí uFL connector</span>
      </div>
    </div>

  </div>
</div>

<div class="spi-diagram">
  <h3>Dual SPI Bus Architecture</h3>
  <div class="spi-bus">
    <div class="spi-device">
      <div class="name">WIZ5500 Ethernet</div>
      <div class="pins">SCK / MOSI / MISO / D9 (CS)</div>
    </div>
    <div class="spi-label">‚Üê SPI Bus 1 (hardware)</div>
  </div>
  <div style="margin: 8px 0; color: #606080;">Feather ESP32-S3</div>
  <div class="spi-bus">
    <div class="spi-label">SPI Bus 2 (bitbang) ‚Üí</div>
    <div class="spi-device">
      <div class="name">RFM95W LoRa</div>
      <div class="pins">D10 / D11 / D12 / D13 (CS)</div>
    </div>
  </div>
</div>

<div class="warn-box">
  <b>‚ö†Ô∏è CRITICAL: Antenna Required!</b><br>
  <b>Never power the RFM95W without an antenna connected.</b> Transmitting without an antenna can permanently damage the radio module. Always attach the spring antenna (#4269) to the uFL connector before powering on.
</div>

<div class="power-note">
  <b>‚ö° Power:</b> Gateway is USB-C powered only ‚Äî no battery needed. Connect to any USB-C power supply or computer backstage. The ESP32-S3 Feather's onboard 3.3V regulator powers both breakout boards.<br><br>
  <b>Power consumption:</b> ~150mA typical (Feather + WIZ5500 + RFM95W idle). Peaks to ~200mA during LoRa transmit.
</div>

<div class="config-box">
  <b>‚öôÔ∏è Configuration (in code.py):</b><br><br>
  <b>Protocol:</b> <code>PROTOCOL = "sacn"</code> or <code>PROTOCOL = "artnet"</code><br><br>
  <b>Network:</b><br>
  <code>USE_DHCP = False</code> ‚Äî set to True for automatic IP<br>
  <code>STATIC_IP = (192, 168, 1, 50)</code> ‚Äî match your network<br>
  <code>SACN_UNIVERSE = 1</code> ‚Äî for sACN mode<br>
  <code>ARTNET_UNIVERSE = 1</code> ‚Äî for ArtNet mode<br>
  <code>MAC_ADDRESS = b"\xDE\xAD\xBE\xEF\xFE\x01"</code> ‚Äî must be unique on network<br><br>
  <b>Device Patch Map:</b> Maps device IDs to DMX start addresses (edit DEVICE_PATCH in code)<br><br>
  <b>CircuitPython pin names:</b><br>
  Ethernet SPI: <code>board.SCK</code>, <code>board.MOSI</code>, <code>board.MISO</code>, <code>board.D9</code> (CS)<br>
  LoRa SPI: <code>board.D10</code> (SCK), <code>board.D11</code> (MOSI), <code>board.D12</code> (MISO), <code>board.D13</code> (CS)<br>
  LoRa RST: <code>board.A0</code> &nbsp;|&nbsp; LoRa IRQ: <code>board.A1</code>
</div>

<div class="note-box">
  <b>üìã Setup Checklist:</b><br>
  1. Install CircuitPython 10.1.1 for "Adafruit Feather ESP32-S3 4MB Flash / 2MB PSRAM" from <a href="https://circuitpython.org/board/adafruit_feather_esp32s3/" style="color:#a0c4ff">circuitpython.org</a><br>
  2. Install libraries into <code>/lib</code>: adafruit_rfm9x.mpy, adafruit_wiznet5k/, adafruit_bus_device/<br>
  3. Copy <code>gateway/code.py</code> to the board as <code>code.py</code><br>
  4. Edit <code>PROTOCOL</code>, <code>STATIC_IP</code>, and universe settings<br>
  5. Connect antenna to RFM95W <b>before</b> applying power<br>
  6. Connect Ethernet cable to network switch or Eos console<br>
  7. In Eos: <b>Setup > Show > Output > Add sACN or ArtNet output</b><br>
  &nbsp;&nbsp;&nbsp;‚Ä¢ sACN: Point universe to gateway's IP address<br>
  &nbsp;&nbsp;&nbsp;‚Ä¢ ArtNet: No IP needed (uses broadcast)<br>
  8. Verify boot: serial monitor shows "Theater LoRa Gateway booting (SACN/ARTNET)..."
</div>

<div class="note-box">
  <b>üîß Troubleshooting:</b><br>
  <b>No packets received?</b><br>
  ‚Ä¢ Check Ethernet link lights on WIZ5500 and switch<br>
  ‚Ä¢ Verify gateway IP is on same subnet as Eos console<br>
  ‚Ä¢ For sACN: ensure Eos has sACN output pointing to gateway IP<br>
  ‚Ä¢ For ArtNet: ensure Eos is sending ArtNet broadcast (no IP config needed)<br>
  ‚Ä¢ Check universe number matches between code and Eos<br><br>
  <b>LoRa not transmitting?</b><br>
  ‚Ä¢ Verify antenna is connected<br>
  ‚Ä¢ Check serial output for "LoRa radio ready"<br>
  ‚Ä¢ Verify matching LoRa settings (SF7, 250kHz BW, 915MHz) on all devices
</div>

</body>
</html>
