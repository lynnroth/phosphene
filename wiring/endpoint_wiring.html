<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Theater LoRa Endpoint Wiring ‚Äî ESP32-S3 Feather</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background: #1a1a2e; color: #e0e0e0; margin: 0; padding: 20px; }
  h1 { color: #e94560; text-align: center; font-size: 1.4em; margin-bottom: 4px; }
  .subtitle { text-align: center; color: #a0a0b0; font-size: 0.85em; margin-bottom: 24px; }

  .diagram { display: flex; justify-content: center; align-items: flex-start; gap: 40px; flex-wrap: wrap; }

  .board {
    background: #16213e;
    border: 2px solid #0f3460;
    border-radius: 10px;
    padding: 14px 10px;
    min-width: 165px;
    position: relative;
  }
  .board h2 { text-align: center; font-size: 0.8em; margin: 0 0 10px 0; color: #e94560; text-transform: uppercase; letter-spacing: 1px; }
  .board .pid { text-align: center; font-size: 0.68em; color: #606080; margin-bottom: 8px; }

  .pin { display: flex; justify-content: space-between; align-items: center; margin: 3px 0; font-size: 0.75em; gap: 6px; }
  .pin-label { padding: 2px 6px; border-radius: 3px; font-weight: bold; white-space: nowrap; }
  .pin-value { color: #a0c4ff; font-size: 0.9em; text-align: right; }

  .pwr   { background: #c0392b; color: #fff; }
  .pwr5  { background: #922b21; color: #fff; }
  .gnd   { background: #2c2c2c; color: #aaa; }
  .sck   { background: #8e44ad; color: #fff; }
  .mosi  { background: #1a6b3a; color: #fff; }
  .miso  { background: #16537e; color: #fff; }
  .cs    { background: #b7770d; color: #fff; }
  .rst   { background: #5d4037; color: #fff; }
  .irq   { background: #1a5276; color: #fff; }
  .data  { background: #0d6b4e; color: #fff; }
  .usb   { background: #7d3c98; color: #fff; }
  .batt  { background: #6e2f1a; color: #fff; }

  .connections {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 5px;
    min-width: 220px;
  }
  .conn-row {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.72em;
  }
  .conn-from { text-align: right; min-width: 100px; font-weight: bold; }
  .conn-arrow { color: #e94560; flex-shrink: 0; }
  .conn-to { min-width: 100px; font-weight: bold; }
  .conn-wire { color: #606080; font-size: 0.85em; margin-left: 4px; }

  .section-title {
    text-align: center;
    font-size: 0.72em;
    color: #e94560;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin: 4px 0 6px 0;
    border-bottom: 1px solid #0f3460;
    padding-bottom: 4px;
  }

  .note-box {
    background: #0f3460;
    border-left: 3px solid #e94560;
    border-radius: 4px;
    padding: 10px 14px;
    margin: 20px auto;
    max-width: 960px;
    font-size: 0.78em;
    line-height: 1.7;
  }
  .note-box b { color: #e94560; }

  .power-note {
    background: #1a0a0a;
    border-left: 3px solid #c0392b;
    border-radius: 4px;
    padding: 10px 14px;
    margin: 10px auto;
    max-width: 960px;
    font-size: 0.78em;
    line-height: 1.7;
  }
  .power-note b { color: #e74c3c; }

  .warn-box {
    background: #2d1a00;
    border-left: 3px solid #f39c12;
    border-radius: 4px;
    padding: 10px 14px;
    margin: 10px auto;
    max-width: 960px;
    font-size: 0.78em;
    line-height: 1.7;
  }
  .warn-box b { color: #f39c12; }

  .config-box {
    background: #0a1a1a;
    border-left: 3px solid #1abc9c;
    border-radius: 4px;
    padding: 10px 14px;
    margin: 10px auto;
    max-width: 960px;
    font-size: 0.78em;
    line-height: 1.7;
  }
  .config-box b { color: #1abc9c; }
  .config-box code { background: #16213e; padding: 1px 5px; border-radius: 3px; font-family: monospace; }

  .parts-list {
    background: #16213e;
    border-radius: 4px;
    padding: 12px 16px;
    margin: 16px auto;
    max-width: 960px;
    font-size: 0.78em;
  }
  .parts-list h3 { color: #e94560; margin: 0 0 8px 0; font-size: 1em; }
  .parts-list table { width: 100%; border-collapse: collapse; }
  .parts-list td { padding: 4px 8px; }
  .parts-list td:first-child { color: #a0c4ff; }
  .parts-list td:last-child { color: #606080; text-align: right; }

  .pin-ref {
    background: #16213e;
    border-radius: 4px;
    padding: 12px 16px;
    margin: 16px auto;
    max-width: 960px;
    font-size: 0.78em;
  }
  .pin-ref h3 { color: #e94560; margin: 0 0 8px 0; font-size: 1em; }
  .pin-ref table { width: 100%; border-collapse: collapse; }
  .pin-ref th { color: #e94560; text-align: left; padding: 6px 8px; border-bottom: 1px solid #0f3460; }
  .pin-ref td { padding: 4px 8px; }
  .pin-ref td:first-child { color: #a0c4ff; font-family: monospace; }
  .pin-ref td:nth-child(2) { color: #1abc9c; font-weight: bold; }
  .pin-ref td:nth-child(3) { color: #e0e0e0; }
  .pin-ref td:last-child { color: #606080; font-size: 0.9em; }
</style>
</head>
<body>

<h1>Theater LoRa ‚Äî Endpoint Wiring</h1>
<div class="subtitle">Adafruit ESP32-S3 Feather (#5477) + RFM95W LoRa (#3072) + bq25185 5V Boost (#6106) + NeoPixels<br>
√ó 2 endpoints ‚Äî set DEVICE_ID = 1 on first, DEVICE_ID = 2 on second</div>

<div class="parts-list">
<h3>Parts per Endpoint</h3>
<table>
  <tr><td>Adafruit ESP32-S3 Feather 4MB Flash / 2MB PSRAM</td><td>#5477</td></tr>
  <tr><td>Adafruit RFM95W LoRa Radio Breakout - 915MHz</td><td>#3072</td></tr>
  <tr><td>Adafruit bq25185 Battery Charger &amp; 5V Boost</td><td>#6106</td></tr>
  <tr><td>915MHz Spring Antenna (uFL)</td><td>#4269</td></tr>
  <tr><td>Lithium Ion Polymer Battery - 3.7v 2500mAh</td><td>#328</td></tr>
  <tr><td>NeoPixel Strip (GRB, 40 pixels recommended)</td><td>varies</td></tr>
  <tr><td>300Œ© resistor (for data line protection)</td><td>‚Äî</td></tr>
  <tr><td>JST-PH 2-pin cable / jumper wires</td><td>‚Äî</td></tr>
</table>
</div>

<div class="pin-ref">
<h3>ESP32-S3 Feather Pin Reference</h3>
<table>
  <tr><th>CircuitPython</th><th>GPIO</th><th>Function</th><th>Notes</th></tr>
  <tr><td><code>board.SCK</code></td><td>GPIO 36</td><td>SPI Clock</td><td>Primary SPI bus</td></tr>
  <tr><td><code>board.MOSI</code></td><td>GPIO 35</td><td>SPI MOSI</td><td>Primary SPI TX</td></tr>
  <tr><td><code>board.MISO</code></td><td>GPIO 37</td><td>SPI MISO</td><td>Primary SPI RX</td></tr>
  <tr><td><code>board.D9</code></td><td>GPIO 9</td><td>LoRa CS</td><td>Chip Select</td></tr>
  <tr><td><code>board.D10</code></td><td>GPIO 10</td><td>LoRa RST</td><td>Reset</td></tr>
  <tr><td><code>board.D11</code></td><td>GPIO 11</td><td>LoRa IRQ</td><td>G0/DIO0 interrupt</td></tr>
  <tr><td><code>board.D5</code></td><td>GPIO 5</td><td>NeoPixel</td><td>Data output</td></tr>
  <tr><td><code>board.A0</code></td><td>GPIO 17</td><td>Analog</td><td>ADC2_CH6</td></tr>
  <tr><td><code>board.A1</code></td><td>GPIO 18</td><td>Analog</td><td>ADC2_CH7</td></tr>
</table>
</div>

<div class="diagram">

  <!-- FEATHER -->
  <div class="board" style="min-width:175px">
    <h2>ESP32-S3 Feather</h2>
    <div class="pid">#5477</div>

    <div class="section-title">Power In</div>
    <div class="pin"><span class="pin-label batt">JST</span><span class="pin-value">‚Üê LiPo battery</span></div>
    <div class="pin"><span class="pin-label usb">USB-C</span><span class="pin-value">programming only</span></div>

    <div class="section-title">Power Out</div>
    <div class="pin"><span class="pin-label pwr">3.3V</span><span class="pin-value">‚Üí RFM95W VIN</span></div>
    <div class="pin"><span class="pin-label gnd">GND</span><span class="pin-value">‚Üí common ground</span></div>

    <div class="section-title">SPI ‚Äî LoRa Radio</div>
    <div class="pin"><span class="pin-label sck">SCK</span><span class="pin-value">‚Üí RFM SCK</span></div>
    <div class="pin"><span class="pin-label mosi">MOSI</span><span class="pin-value">‚Üí RFM MOSI</span></div>
    <div class="pin"><span class="pin-label miso">MISO</span><span class="pin-value">‚Üí RFM MISO</span></div>
    <div class="pin"><span class="pin-label cs">D9</span><span class="pin-value">‚Üí RFM CS</span></div>
    <div class="pin"><span class="pin-label rst">D10</span><span class="pin-value">‚Üí RFM RST</span></div>
    <div class="pin"><span class="pin-label irq">D11</span><span class="pin-value">‚Üí RFM G0/IRQ</span></div>

    <div class="section-title">NeoPixel Output</div>
    <div class="pin"><span class="pin-label data">D5</span><span class="pin-value">‚Üí NeoPixel DIN</span></div>
  </div>

  <!-- CONNECTION TABLES -->
  <div style="display:flex; flex-direction:column; gap:20px;">

    <div class="connections">
      <div class="section-title">RFM95W LoRa Breakout (#3072)</div>
      <div class="conn-row">
        <span class="conn-from" style="color:#c0392b">Feather 3.3V</span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#c0392b">VIN</span>
        <span class="conn-wire">red</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#888">Feather GND</span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#888">GND</span>
        <span class="conn-wire">black</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#8e44ad">SCK <span style="color:#1abc9c">(GPIO36)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#8e44ad">SCK</span>
        <span class="conn-wire">orange</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#1a6b3a">MOSI <span style="color:#1abc9c">(GPIO35)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#1a6b3a">MOSI</span>
        <span class="conn-wire">green</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#16537e">MISO <span style="color:#1abc9c">(GPIO37)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#16537e">MISO</span>
        <span class="conn-wire">blue</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#b7770d">D9 <span style="color:#1abc9c">(GPIO9)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#b7770d">CS</span>
        <span class="conn-wire">yellow</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#795548">D10 <span style="color:#1abc9c">(GPIO10)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#795548">RST</span>
        <span class="conn-wire">brown</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#1a5276">D11 <span style="color:#1abc9c">(GPIO11)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#1a5276">G0 (IRQ)</span>
        <span class="conn-wire">white</span>
      </div>
      <div class="conn-row" style="margin-top:6px">
        <span style="color:#e94560; font-weight:bold">ANTENNA:</span>
        <span style="color:#606080">Spring antenna (#4269) ‚Üí uFL connector</span>
      </div>
    </div>

    <div class="connections">
      <div class="section-title">bq25185 Charger/Booster (#6106)</div>
      <div class="conn-row">
        <span class="conn-from" style="color:#6e2f1a">LiPo + (red)</span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#6e2f1a">BATT + (JST)</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#888">LiPo ‚àí (black)</span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#888">BATT ‚àí (JST)</span>
      </div>
      <div class="conn-row" style="margin-top:8px">
        <span class="conn-from" style="color:#922b21">5V OUT +</span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#922b21">NeoPixel VCC/5V</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#888">5V OUT ‚àí</span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#888">NeoPixel GND</span>
      </div>
      <div class="conn-row" style="margin-top:6px">
        <span style="color:#7d3c98; font-weight:bold">USB-C:</span>
        <span style="color:#606080">charge input (backstage only)</span>
      </div>
    </div>

    <div class="connections">
      <div class="section-title">NeoPixel Strip</div>
      <div class="conn-row">
        <span class="conn-from" style="color:#922b21">bq 5V OUT +</span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#922b21">VCC / 5V</span>
        <span class="conn-wire">red</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#888">common GND</span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#888">GND</span>
        <span class="conn-wire">black</span>
      </div>
      <div class="conn-row">
        <span class="conn-from" style="color:#0d6b4e">D5 <span style="color:#1abc9c">(GPIO5)</span></span>
        <span class="conn-arrow">‚Üí</span>
        <span class="conn-to" style="color:#0d6b4e">DIN (DATA IN)</span>
        <span class="conn-wire">green</span>
      </div>
      <div class="conn-row" style="margin-top:6px">
        <span style="color:#f39c12; font-weight:bold">Note:</span>
        <span style="color:#606080">300Œ© resistor inline on DIN recommended</span>
      </div>
      <div class="conn-row">
        <span style="color:#e94560; font-weight:bold">Direction:</span>
        <span style="color:#606080">DIN is at strip start ‚Äî arrows point away</span>
      </div>
    </div>

  </div>
</div>

<div class="warn-box">
  <b>‚ö†Ô∏è CRITICAL: Antenna Required!</b><br>
  <b>Never power the RFM95W without an antenna connected.</b> Transmitting without an antenna can permanently damage the radio module. Always attach the spring antenna (#4269) to the uFL connector before powering on.
</div>

<div class="power-note">
  <b>‚ö° Power Architecture (Single LiPo):</b><br>
  The battery feeds two parallel power paths that share a common ground:<br><br>
  <b>Path 1 ‚Äî Feather (3.3V):</b> LiPo ‚Üí Feather JST ‚Üí onboard regulator ‚Üí ESP32-S3 + RFM95W<br>
  <b>Path 2 ‚Äî NeoPixels (5V):</b> LiPo ‚Üí bq25185 BATT port ‚Üí 5V boost ‚Üí NeoPixel strip<br><br>
  <b>Wiring the shared LiPo:</b> Connect the battery to the Feather JST normally. Then splice a second set of wires from the battery connector (or use a Y-splitter) to feed the bq25185 BATT input. Alternatively, tap from the Feather's <code>BAT</code> pin.<br><br>
  <b>Charging:</b> Use the <b>bq25185 USB-C port only</b> for charging during use. The Feather USB-C is for programming only ‚Äî do not connect both USB-C ports simultaneously.
</div>

<div class="warn-box">
  <b>‚ö†Ô∏è Current Limits:</b><br>
  ‚Ä¢ <b>bq25185 5V boost max: 1A</b> ‚Äî 40 pixels at full white = 2.4A (exceeds limit)<br>
  ‚Ä¢ Keep brightness moderate and avoid full-white effects<br>
  ‚Ä¢ At typical theatrical intensity (30-50%), current stays well within limits<br>
  ‚Ä¢ Runtime on 2500mAh: ~4.5 hours at typical load
</div>

<div class="config-box">
  <b>‚öôÔ∏è Configuration (in code.py):</b><br>
  <code>DEVICE_ID = 1</code> &nbsp;or&nbsp; <code>DEVICE_ID = 2</code> ‚Äî must be unique per endpoint<br>
  <code>NUM_PIXELS = 40</code> ‚Äî match your actual strip length<br>
  <code>NEOPIXEL_PIN = board.D5</code> ‚Äî change if using different GPIO<br><br>
  <b>CircuitPython pin names:</b><br>
  SPI: <code>board.SCK</code>, <code>board.MOSI</code>, <code>board.MISO</code><br>
  RFM CS: <code>board.D9</code> &nbsp;|&nbsp; RFM RST: <code>board.D10</code> &nbsp;|&nbsp; RFM IRQ: <code>board.D11</code><br>
  NeoPixel: <code>board.D5</code>
</div>

<div class="note-box">
  <b>üìã Setup Checklist:</b><br>
  1. Install CircuitPython 10.1.1 for "Adafruit Feather ESP32-S3 4MB Flash / 2MB PSRAM" from <a href="https://circuitpython.org/board/adafruit_feather_esp32s3/" style="color:#a0c4ff">circuitpython.org</a><br>
  2. Install libraries into <code>/lib</code>: adafruit_rfm9x.mpy, neopixel.mpy, adafruit_pixelbuf.mpy<br>
  3. Copy <code>endpoint/code.py</code> to the board as <code>code.py</code><br>
  4. Edit <code>DEVICE_ID</code> and <code>NUM_PIXELS</code> at the top of the file<br>
  5. Connect antenna to RFM95W <b>before</b> applying power<br>
  6. Verify boot: pixels flash briefly white, serial monitor shows "Theater LoRa Endpoint N ready"
</div>

</body>
</html>
